---
import { Image, getImage } from "astro:assets";
import Layout from "../layouts/Layout.astro";

import { Icon } from "astro-icon/components";

import cocBackground from "../assets/2025/bg/vendorhall.png";
const optimizedCocBackground = await getImage({
  src: cocBackground,
  format: "avif",
  width: 2000,
});


import vendor from "../assets/2025/vendors/dealers_room.png";

import vendors from "@data/vendors.js";

const optimizedVendor = await getImage({
  src: vendor,
  format: "avif",
  width: 1080,
});

import table1 from "../assets/2025/vendors/dealers_room/0 glow.png";
import table2 from "../assets/2025/vendors/dealers_room/1 glow.png";
import table3 from "../assets/2025/vendors/dealers_room/2 glow.png";
import table4 from "../assets/2025/vendors/dealers_room/3 glow.png";
import table5 from "../assets/2025/vendors/dealers_room/4 glow.png";
import table6 from "../assets/2025/vendors/dealers_room/5 glow.png";
import table7 from "../assets/2025/vendors/dealers_room/6 glow.png";
import table8 from "../assets/2025/vendors/dealers_room/7 glow.png";
import table9 from "../assets/2025/vendors/dealers_room/8 glow.png";
import table10 from "../assets/2025/vendors/dealers_room/9 glow.png";
import table11 from "../assets/2025/vendors/dealers_room/10 glow.png";
import table12 from "../assets/2025/vendors/dealers_room/11 glow.png";
import table13 from "../assets/2025/vendors/dealers_room/12 glow.png";
import table14 from "../assets/2025/vendors/dealers_room/13 glow.png";
import table15 from "../assets/2025/vendors/dealers_room/14 glow.png";
import table16 from "../assets/2025/vendors/dealers_room/15 glow.png";
import table17 from "../assets/2025/vendors/dealers_room/16 glow.png";
import table18 from "../assets/2025/vendors/dealers_room/17 glow.png";
import table19 from "../assets/2025/vendors/dealers_room/18 glow.png";
import table20 from "../assets/2025/vendors/dealers_room/19 glow.png";
import table21 from "../assets/2025/vendors/dealers_room/20 glow.png";
import table22 from "../assets/2025/vendors/dealers_room/21 glow.png";
import table23 from "../assets/2025/vendors/dealers_room/22 glow.png";
import table24 from "../assets/2025/vendors/dealers_room/23 glow.png";
import table25 from "../assets/2025/vendors/dealers_room/24 glow.png";
import table26 from "../assets/2025/vendors/dealers_room/25 glow.png";
import table27 from "../assets/2025/vendors/dealers_room/26 glow.png";
import table28 from "../assets/2025/vendors/dealers_room/27 glow.png";
import table29 from "../assets/2025/vendors/dealers_room/28 glow.png";
import table30 from "../assets/2025/vendors/dealers_room/29 glow.png";
import table31 from "../assets/2025/vendors/dealers_room/30 glow.png";
import table32 from "../assets/2025/vendors/dealers_room/31 glow.png";
import table33 from "../assets/2025/vendors/dealers_room/32 glow.png";
import table34 from "../assets/2025/vendors/dealers_room/33 glow.png";
import table35 from "../assets/2025/vendors/dealers_room/34 glow.png";
import table36 from "../assets/2025/vendors/dealers_room/35 glow.png";
import table37 from "../assets/2025/vendors/dealers_room/36 glow.png";
import table38 from "../assets/2025/vendors/dealers_room/37 glow.png";
import table39 from "../assets/2025/vendors/dealers_room/38 glow.png";
import table40 from "../assets/2025/vendors/dealers_room/39 glow.png";
import table41 from "../assets/2025/vendors/dealers_room/40 glow.png";
import table42 from "../assets/2025/vendors/dealers_room/41 glow.png";
import table43 from "../assets/2025/vendors/dealers_room/42 glow.png";
import table44 from "../assets/2025/vendors/dealers_room/Constore glow.png";

import pepper from "../assets/2025/staff/pepper.png";

const tables = [
  table1,
  table2,
  table3,
  table4,
  table5,
  table6,
  table7,
  table8,
  table9,
  table10,
  table11,
  table12,
  table13,
  table14,
  table15,
  table16,
  table17,
  table18,
  table19,
  table20,
  table21,
  table22,
  table23,
  table24,
  table25,
  table26,
  table27,
  table28,
  table29,
  table30,
  table31,
  table32,
  table33,
  table34,
  table35,
  table36,
  table37,
  table38,
  table39,
  table40,
  table41,
  table42,
  table43,
  table44
]

import Footer from "../components/Footer.astro";
---

<Layout title="HarmonyCon 2025 | Vendors">
  <div id="bg" class="flex flex-col pt-8 md:pt-16 gap-y-8 px-4 md:px-0">
    <div class="relative flex flex-row justify-center items-center">
      <div
      id="vendors-map"
        class="text-black bg-white flex flex-col lg:flex-row items-center -rotate-1 rounded w-[95%] md:w-[95%] lg:w-[95%] xl:w-[95%] 2xl:w-[40%] lg:aspect-[0.829] h-auto"
        style={`filter: drop-shadow(0 5px 5px #000); background-image: url(${optimizedVendor.src}); background-size: contain; background-repeat: no-repeat;`}
      >
        {
          vendors.map(({ id, left, top, width, height }, i) => (
              <Image id={`table-${id}`} format="avif" src={tables[id === "0" ? tables.length - 1 : parseInt(id) - 1]} width={800} alt={`Table #${i+1}`} class={`w-full absolute highlight-orange z-0 opacity-0 duration-300`}/> 
              <div
                id={`regular-${id}`}
                style={`left: ${left}%; top: ${top}%; width: ${width}%; height: ${height}%;`}
                class={`bg-transparent opacity-50 table z-50`}
              >
                
              </div>
          ))
        }
    <!-- <div class="my-8 lg:mt-16 grid grid-cols-1 md:grid-cols-2 xl:grid-cols-2 2xl:grid-cols-3 justify-center w-full xl:px-0 px-2 xl:w-5/6 2xl:w-4/5 gap-8 ">
      {
        vendors.map(({id, name, src, desc, selling }) =>
          <div id={`card-${id}`} class="relative cursor-pointer group hover:bg-orange-500 hover:text-white duration-300 w-full bg-[#fcf1e0] rounded p-8 flex flex-col" style="filter: drop-shadow(0 10px 10px #000); ">
            <div class="flex justify-between mb-4 items-center">
              <div class="text-3xl md:text-3xl lg:text-4xl font-bold uppercase ">{name}</div>
              <div id="vendor-pfp" style={`background-image: url(/pfp/${src});`} class="bg-cover bg-center aspect-square h-14 md:h-14 lg:h-14 xl:h-16 2xl:h-20 border border-black bg-transparent">

              </div>
            </div>
            
            <hr class="border-2 border-black group-hover:border-white duration-300 mb-4"/>
            
            <div class="italic leading-snug text-sm md:text-sm lg:text-base mb-4" set:html={desc}> 
            </div>

            <div class="px-0 text-xs md:text-xs lg:text-sm italic mb-1">This vendor will be selling:</div>
            <ul class='px-4 text-base mb-12'>
              {
                selling.map(item => <li class='my-0.5 text-xs md:text-xs lg:text-sm uppercase font-medium px-2 border-b-2 block border-black group-hover:border-white '>{item}</li>)
              }
            </ul>
            <div class="font-semibold absolute bottom-0 text-center left-0 right-0 mx-auto w-full mb-8 lg:mb-4 text-sm">
              Click this card see this vendor's location!
            </div>
          </div>
        )
      }
    </div> -->
      </div>
      <div id="vendors-list" class="cursor-move absolute right-[10%] top-0 w-fit p-4 font-sans font-medium text-black bg-white flex flex-col lg:flex-row items-center rotate-3 rounded-xl"  style={`filter: drop-shadow(0 5px 5px #000); `}>
        <div class="columns-1">
          {vendors.map(({ id, name, left, top, width, height }) => (
          <div id={`vendor-item-${id}`} class="flex flex-row gap-x-2 px-1 py-0 items-center hover:bg-black hover:text-white duration-300 cursor-move rounded">
            <div class="w-8 text-sm text-right font-mono">{['69', '1'].includes(id) ? 'HC' : (+id) - 1}</div>
            <Image src={pepper} alt={name} width={32} format="avif" class="w-4 h-4 rounded"/>
            <div class="text-center text-sm whitespace-nowrap">
              {name}
            </div>
          </div>
          ))}
        </div>
      </div>
    </div>
    <Footer />
  </div>

  <style
    define:vars={{
      optimizedCocBackground: `url(${optimizedCocBackground.src})`,
    }}
  >

.table {
    @apply text-center flex items-center  justify-center cursor-pointer  absolute;
  }

  .grayscale {
        filter: brightness(60%) grayscale(100) hue-rotate(0deg);
      }

      .highlight-orange {
        filter: invert(21%) sepia(13%) saturate(4615%) hue-rotate(335deg)
          brightness(97%) contrast(89%) drop-shadow(0 3px 3px #000);
      }

      .highlight-green {
        filter: invert(47%) sepia(56%) saturate(559%) hue-rotate(36deg)
          brightness(103%) contrast(87%) drop-shadow(0 3px 3px #000);
      }


    :root {
      --elastic: linear(
        0,
        0.0009 8.51%,
        -0.0047 19.22%,
        0.0016 22.39%,
        0.023 27.81%,
        0.0237 30.08%,
        0.0144 31.81%,
        -0.0051 33.48%,
        -0.1116 39.25%,
        -0.1181 40.59%,
        -0.1058 41.79%,
        -0.0455,
        0.0701 45.34%,
        0.9702 55.19%,
        1.0696 56.97%,
        1.0987 57.88%,
        1.1146 58.82%,
        1.1181 59.83%,
        1.1092 60.95%,
        1.0057 66.48%,
        0.986 68.14%,
        0.9765 69.84%,
        0.9769 72.16%,
        0.9984 77.61%,
        1.0047 80.79%,
        0.9991 91.48%,
        1
      );

      --sine: linear(
        0,
        0.007 5.35%,
        0.0282 10.75%,
        0.0638 16.26%,
        0.1144 21.96%,
        0.1833 28.16%,
        0.2717 34.9%,
        0.6868 62.19%,
        0.775 68.54%,
        0.8457 74.3%,
        0.9141 81.07%,
        0.9621 87.52%,
        0.9905 93.8%,
        1
      );
    }
    #bg {
      position: absolute;

      top: 0;
      left: 0;
      width: 100%;
      height: auto;
      min-height: 100%;
      background-image: var(--optimizedCocBackground);
      background-repeat: no-repeat;
      background-size: cover;
      background-position: center;
      opacity: 1;
    }

    .card1 {
      animation:
      /* reveal 0.7s cubic-bezier(0.5, 0.1, 0.1, 1) 0.6s forwards,
      zoom 0.75s ease-out 0.6s forwards, */ floating1
        4s var(--sine) 0s infinite forwards;
    }

    .card2 {
      animation:
      /* reveal 0.7s cubic-bezier(0.5, 0.1, 0.1, 1) 0.8s forwards,
      zoom 0.75s ease-out 0.9s forwards, */ floating2
        5s var(--sine) 0.4s infinite forwards;
    }

    .card3 {
      animation:
      /* reveal 0.7s cubic-bezier(0.5, 0.1, 0.1, 1) 1s forwards,
      zoom 0.75s ease-out 1.2s forwards, */ floating3
        4.5s var(--sine) 0.8s infinite forwards;
    }

    @keyframes reveal {
      from {
        /* bottom: -150vh; */
        opacity: 1;
        transform: translateY(-300%);
      }
      to {
        opacity: 1;
        transform: translateY(0%);
      }
    }
    @keyframes zoom {
      from {
        rotate: 10deg;
        scale: 1;
      }
      to {
        rotate: -0.3deg;
        scale: 1;
      }
    }

    @keyframes floating1 {
      0% {
        translate: 0px 0px;
      }
      50% {
        translate: 0px 6px;
      }
      100% {
        translate: 0px 0px;
      }
    }

    @keyframes floating2 {
      0% {
        translate: 0px 0px;
      }
      50% {
        translate: 0px -6px;
      }
      100% {
        translate: 0px 0px;
      }
    }

    @keyframes floating3 {
      0% {
        translate: 0px 0px;
      }
      50% {
        translate: 0px 5px;
      }
      100% {
        translate: 0px 0px;
      }
    }
  </style>
</Layout>



<script define:vars={{ vendors }}>
  const trigger = () => {
    const ad = document.getElementById("ad");
    if (window.innerWidth <= 1280 && ad) {
      window.addEventListener('scroll', () => {
        const appear = 20;
        if (window.pageYOffset <= appear) {
          // If more show the element
          ad.style.opacity = '1'
          ad.style.pointerEvents = 'all'
        } else {
          // Else hide it
          ad.style.opacity = '0'
          ad.style.pointerEvents = 'none'
        }
      });
    }

    let activeID = '';
    const highlight = (id) => {
      // Handle table highlight
      if (activeID) {
        const prevTable = document.getElementById(`table-${activeID}`);
        const prevVendorItem = document.getElementById(`vendor-item-${activeID}`);
        if (prevTable) {
          prevTable.style.opacity = '0';
        }
        if (prevVendorItem) {
          prevVendorItem.style.backgroundColor = '';
          prevVendorItem.style.color = '';
        }
      }
      const currentTable = document.getElementById(`table-${id}`);
      const currentVendorItem = document.getElementById(`vendor-item-${id}`);
      if (currentTable) {
        currentTable.style.opacity = '1';
      }
      if (currentVendorItem) {
        currentVendorItem.style.backgroundColor = '#000000';
        currentVendorItem.style.color = '#ffffff';
      }
      activeID = id;
    };

    vendors.forEach(({id}) => {
      // Table hover highlight
      if (document.getElementById(`regular-${id}`)) {
        const tableElement = document.getElementById(`regular-${id}`);
        tableElement?.addEventListener("mouseenter", () => highlight(id));
        tableElement?.addEventListener("mouseleave", () => {
          const vendorItem = document.getElementById(`vendor-item-${id}`);
          if (vendorItem) {
            vendorItem.style.backgroundColor = '';
            vendorItem.style.color = '';
          }
          const table = document.getElementById(`table-${id}`);
          if (table) {
            table.style.opacity = '0';
          }
          activeID = '';
        });
      }
      
      // Vendor list item hover highlight
      const vendorItem = document.getElementById(`vendor-item-${id}`);
      if (vendorItem) {
        vendorItem.addEventListener("mouseenter", () => highlight(id));
      }
    });

    // Add click and drag interactions for vendors list
    const vendorsList = document.getElementById('vendors-list');
    if (vendorsList) {
      let isDragging = false;

      // Add transition property for smooth background color changes
      vendorsList.style.transition = 'background-color 300ms ease, opacity 300ms ease';

      vendorsList.addEventListener('mousedown', () => {
        vendorsList.style.backgroundColor = '#fff9e6'; // Slightly yellow background on click
      });

      vendorsList.addEventListener('mouseup', () => {
        if (!isDragging) {
          vendorsList.style.backgroundColor = '#ffffff'; // Reset to white when not dragging
        }
      });

      vendorsList.addEventListener('mouseleave', () => {
        vendorsList.style.backgroundColor = '#ffffff'; // Reset to white when mouse leaves
      });

      // Dragging functionality
      vendorsList.addEventListener('mousedown', (e) => {
        isDragging = false;
        const startX = e.clientX - vendorsList.offsetLeft;
        const startY = e.clientY - vendorsList.offsetTop;

        function onMouseMove(e) {
          isDragging = true;
          vendorsList.style.backgroundColor = '#ffffff';
          vendorsList.style.opacity = '0.5'; // 50% opacity while dragging
          vendorsList.style.left = e.clientX - startX + 'px';
          vendorsList.style.top = e.clientY - startY + 'px';
        }

        function onMouseUp() {
          document.removeEventListener('mousemove', onMouseMove);
          document.removeEventListener('mouseup', onMouseUp);
          if (isDragging) {
            vendorsList.style.backgroundColor = '#ffffff'; // Reset to white after drag
            vendorsList.style.opacity = '1'; // Reset opacity
          }
        }

        document.addEventListener('mousemove', onMouseMove);
        document.addEventListener('mouseup', onMouseUp);
      });
    }
  };

  trigger();
</script>